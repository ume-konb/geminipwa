# titan823によるフォーク版 GeminiPWA(ti) の変更点・仕様（2025年5月時点）
-  ⚠️ストリーミング出力の問題とインターネットからの情報取得の問題を解消致しました。2025/05/15
-  ⚠️Thinking Budgetが使用できない問題点を修正いたしました。2025/05/16
-  ⚠️ストリーミング使用時の意図しない挙動を修正いたしました。UIの挙動に関するバグですので、更新をよろしくお願いいたします。2025/05/16 18:48
-  設定画面下部の“アプリを更新（キャッシュクリア）”ボタン” を押してアップグレードしてください。ご利用中の方には大変ご迷惑をおかけ致しました。
### ■ 注意事項

-  本PWAを初めてのデバイスから使用する場合は、必ず無料モデルを用いて必要最低限の機能構成からテストしてください。
-  当フォークは私用目的のため、性質上、サポートは行われません。本コードの編集・仕様変更のプロセスにおいて予告・告知などは行いません。また、本コードの更新は予告なく終了致します。
-  本コードはスマホブラウザ上での使用を想定としております。アプリ化やWindows上でのローカル使用などについてはデバッグ致しておりません。
-  ボタン類はヘッダーの余白を十分に確保し、必要な物のみ表示オンにしてください。（ヘッダーを圧迫し、⚙️ボタンが溢れるため。チャット画面から左右スワイプで画面移動”オプションをオフにしている場合、設定画面に入れなくなるおそれがあります。）
-  PWA使用中に解決困難な問題が生じた場合は本PWAに関するキャッシュを全て削除することを推奨致します。
-  Gemini以外のAPIに対応する予定はございません。
-  本コードはフォーク元の後継となることを意図するものでは断じてございません。フォーク元コードに対し異を唱える意図も一切ございません。本フォークはプルリクエストを行いません。私的使用を目的とするバリュエーションのひとつと捉えてください。
-  フォーク元コードの製作者様を除き、ご質問・ご意見・ご要望は承りません。 また、本コードによって損害や影響が生じた場合においても、公開陣は一切の責任を負いません。
-  本コードの利用基準（本コードの改変、コードのフォーク、他コードへのコード流用など）は、本コードのフォーク元の基準に準拠致します。（MITライセンス）
  
## ■ 利用方法（PWA）

本フォークのPWAはブラウザから以下のURLで利用可能です：
https://titan823.github.io/geminipwa/#chat

## ■ 更新履歴
### 【2025/05/21】
- リトライ時の確認ダイアログを無効にするオプションを追加
- gemini-2.5-flash-preview-05-20をデフォルトモデルオプションに追加
### 【2025/05/20】
- AI間会話モード（セッション間リンク）追加しました。（後述）
- ダイスボタン（🎲）をフッターに追加しました。
- 設定画面・履歴画面のUIをコンパクト化しました。
### 【2025/05/18】
- メッセージフォントサイズの設定オプションを追加
- メッセージの折り畳み状態を記憶するオプションを追加
- コードブロックへコピーボタン追加
### 【2025/05/17】
- チャットアイコンに付属する名前の背景にバブルを設定できるよう機能追加
- ボタンレイアウトの整理・コンパクト化
- AI応答内の折り畳まれた推論の部分について、クリックすると内容が表示/非表示されるようになりました。
- メッセージ編集ツールバーに「貼付け」ボタンを追加
### 【2025/05/16】
- メッセージツールバー透明度のオプションを追加
- テキスト入力時の自動ズーム防止機能を追加しました。スマホ等でテキスト入力時に意図せずズームするのを防ぎます。
### 【2025/05/15】
- 「メッセージ送信/受信時の自動スクロール」をオン/オフするオプションを追加
- 設定画面の「※取り扱い注意項目※」セクションに、「全履歴削除」ボタンを追加
### 【2025/05/14】
- テーマにパステルカラー5種を追加
- ヘッダーにクリップボードスタックボタン🗒️を追加（セッション内でコピーボタンを押すと自動で累積的に欄にテキスト一時スタック）
- ヘッダーにスクロールの上下移動ボタン🔼🔽を追加
- SNS的なチャットアイコン機能を実装
- ワンタップ（多分）でクリップボードのテキストをメッセージ入力欄にペーストできるボタンを、入力欄の左隣に追加
### 【2025/05/13】
- ヘッダーに以下を追加：
  - セッション削除ボタン
  - セッションコピーボタン
  - メモ欄📝（テキスト一時保存用）
  - メッセージバブルの「**全表示/非表示（🖼️）**」ボタン（背景画像観賞用です）
  - 全セッションの一括インポート、一括エクスポートボタン
- 各メッセージに **折りたたみボタン** を追加
- **透明度設定の追加：**
  1. **メッセージバブルの透明度**
     - 設定画面に `0.0～1.0` の数値フィールドを追加（ステップ：0.05）
     - メッセージバブルの透明度が変更可能（※文字色は変更なし）
  2. **ヘッダーとフッターの透明度**
     - 同様に `0.0～1.0` の設定が可能（※文字色・アイコン色は変更なし）
     - チャット背景オーバーレイの透明度も変更可能
### 【2025/05/12】
- モデルオプションに **Gemini 2.5 Pro Preview 05-06** を追加
  ※Google Cloudに支払い方法の登録が必要です。
- 各出入力の下部に **ピンク色の「コピー」ボタン** を追加
---

- **コード量を抑えるため、コード内コメントを削除しました。**

# AI間会話モード（セッション間リンク）
概説:2つのチャット履歴を繋げ、一方のAIの返事をもう一方のAIへの質問として使い、AI同士の会話を仲介する機能です。セッションを跨ぐことでキャラクター同士を会話させたり、一方のAIにユーザーの代理を演じさせ自動で応答させたり、美咲先生同士を戦わせたりできます。
使い方:
1. 有効化: 設定（⚙️）で「セッション間リンク機能」をオン。
2. リンク: 履歴画面（☰）で、会話させたい2つの履歴の「🔗」ボタンを押してリンク（緑とピンクで表示）。
3. 実行: リンクしたどちらかのチャット画面を開き、フッターの「👥」ボタンを押す。
    * 現在のAIの返事が、もう一方のAIへの質問として自動送信。
    * その応答が、さらに現在のAIへの質問として自動送信され、最終結果が表示されます。
    * 処理中は「AI間会話処理中…」などと表示されます。
 - 各履歴には、このAI間のやり取りが通常のメッセージとして記録されます。
- AI同士の会話を行うという点をAI達に認識させるためには前振り・導入をする必要があります。
例:あなたにはこれから、他のAIと会話してもらいます。お題は“熊と虎のどちらが強いか”です。次の入力以降はユーザーの入力ではありません。では、始めましょう。）
- ※注意点:本機能は試験的かつ遊戯的な機能です。また、自明な点ですが、リンクに用いる両セッション分のトークンが消費されます。動作確認は必ず無料モデルを用いて検証してください。
- 出入力以外のリンクは行わないため、メッセージの編集やリトライなどをしたい場合、双方のセッションにて手動でメッセージを整える操作を行う必要があります。
- リンク中はどちらか一方のセッションのみを使用することを推奨いたします。
---
以下はフォーク元リポジトリ（2025/05/15）のREADME.md全文です。

# Gemini PWA Client

このリポジトリは、PWA（Progressive Web App）で作られたGemini APIのクライアントアプリケーションです。  
PWAとは実体がhtmlなだけの簡易アプリです。ブラウザがあれば使えます。
単純な文字チャット機能だけでファイルや画像関連の機能はありません。

## 使い方

Github Pagesで公開されたこのページにアクセスするだけです。  

[index.htmlへのリンク(Github Pages)](https://ona-oni.github.io/geminipwa/)
※このリポジトリの内容が静的にアクセスできる

1. GeminiのAPIキーを準備。
2. 上のリンクにアクセス。
3. 設定画面にGemini APIキーを設定して設定を保存。
4. チャット画面からチャット。

## PCのローカルでホストする
Webサイト上のは信用ならんからローカルで使いたい！という人はWindowsのみ下記の方法で使えます。
1. このリポジトリの全ファイルをダウンロードして同じフォルダ内に配置  
（サイト上部の緑の「Code」から「Download ZIP」）
2. __winlocal.batを起動
3. batのプロンプトが開いている間はローカルhttpサーバーからindex.htmlへアクセス可能

## ブラウザからPWAをアプリとしてインストール(任意)
PWAアプリとしてインストールするとアプリアイコンを作成できます。  
ブラウザにより挙動は違いますが、アドレスバーの横や設定ボタンなどから「XXをインストール」の項目を探してください。    
(モバイル用Chromeなら「ホーム画面に追加」が上記操作に相当）  
インストールしなくてもブラウザはPWAアプリをPWAアプリとして扱います。

## ファイルの説明
* manifest.json : PWAアプリの定義
* index.html : アプリそのもの
* sw.js : PWAサービスワーカー(PWAアプリとしてのファイルキャッシュなどを管理)
* marked.js : マークダウン表示用ライブラリ(MIT Lic)  

sw.jsのおかげで一度アクセスしたらブラウザ内に必要ファイル(「index.html」や「manifest.json」など)がキャッシュされる  
一度キャッシュされたら、設定から更新しない限り更新されない

## データの保存と通信について
* 設定やチャット履歴含む全てのデータはローカルのIndexedDBに保存されます。  
（ブラウザの中のデータベース。Github Pagesの当リポジトリのオリジン)
* 通信はGeminiAPIとしか行いません。(検索機能はGemini側の機能です)
* 履歴は履歴一覧からテキストファイルとしてエクスポートできます  
逆(インポート)は今のところ~~できません~~できます  
注:現状、アップロードされたファイルはエクスポートtxtには含まれません

## Dependencies
This project uses the following third-party libraries:

*   **Marked.js:** [MIT License](https://github.com/markedjs/marked/blob/master/LICENSE.md) - Used for rendering Markdown.
